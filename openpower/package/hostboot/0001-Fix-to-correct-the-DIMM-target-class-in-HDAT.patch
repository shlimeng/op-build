From def798ef42ed7f9fb251c81798e1ecd3c9d278b6 Mon Sep 17 00:00:00 2001
From: nagurram-in <nagendra.g@in.ibm.com>
Date: Thu, 26 Apr 2018 08:08:57 -0500
Subject: [PATCH] Fix to correct the DIMM target class in HDAT

Change-Id: Ie44198a6be00af1be1af1db32f3d07d72296eca1
---
 src/usr/hdat/hdatmsvpd.C |  4 ++--
 src/usr/hdat/hdatutil.C  | 12 +-----------
 2 files changed, 3 insertions(+), 13 deletions(-)

diff --git a/src/usr/hdat/hdatmsvpd.C b/src/usr/hdat/hdatmsvpd.C
index faca545..e5593db 100755
--- a/src/usr/hdat/hdatmsvpd.C
+++ b/src/usr/hdat/hdatmsvpd.C
@@ -1208,7 +1208,7 @@ errlHndl_t  HdatMsVpd::hdatLoadMsData(uint32_t &o_size, uint32_t &o_count)
                          ++l_mcbistIdx)
             {
                 TARGETING::Target *l_pMcbistTarget = l_mcbistList[l_mcbistIdx];
-
+                
                 TARGETING::PredicateCTM l_mcsPredicate(TARGETING::CLASS_UNIT,
                                                        TARGETING::TYPE_MCS);
 
@@ -1223,6 +1223,7 @@ errlHndl_t  HdatMsVpd::hdatLoadMsData(uint32_t &o_size, uint32_t &o_count)
                                     TARGETING::TargetService::CHILD,
                                     TARGETING::TargetService::ALL,
                                     &l_funcMcs);
+                uint32_t l_memBusFreq = getMemBusFreq(l_pMcbistTarget);
 
                 //scan all mcs in this proc to get sharing counit
                 for(uint32_t l_mcsIdx = 0;l_mcsIdx<l_mcsList.size(); ++l_mcsIdx)
@@ -1432,7 +1433,6 @@ errlHndl_t  HdatMsVpd::hdatLoadMsData(uint32_t &o_size, uint32_t &o_count)
                             
                             uint32_t l_dimmId = 
                                     1 << (31 - (l_pDimmTarget->getAttr<TARGETING::ATTR_FAPI_POS>() % MAX_DIMMS_PER_MCBIST));
-                            uint32_t l_memBusFreq = getMemBusFreq(l_pDimmTarget);
                             l_err = addRamFru(l_index,
                                               l_pDimmTarget,
                                               l_dimmRid,
diff --git a/src/usr/hdat/hdatutil.C b/src/usr/hdat/hdatutil.C
index 64cd9b4..63b6a31 100644
--- a/src/usr/hdat/hdatutil.C
+++ b/src/usr/hdat/hdatutil.C
@@ -2191,20 +2191,10 @@ uint32_t getMemBusFreq(const TARGETING::Target* i_pTarget)
                         i_pTarget->getAttr<TARGETING::ATTR_HUID>());
             }
     }
-    else if((l_class == TARGETING::CLASS_UNIT) && (l_type == TARGETING::TYPE_DIMM))
-    {
-        TARGETING::TYPE  l_mcbistType = TARGETING::TYPE_MCBIST;
-        if(getParent(i_pTarget,l_mcbistType)
-                ->tryGetAttr<TARGETING::ATTR_MSS_FREQ>(l_MemBusFreqInMHz) == false )
-            {
-                HDAT_ERR(" MSS_FREQ not present for MCBIST with huid [0x%08X]",
-                getParent(i_pTarget,l_mcbistType)->getAttr<TARGETING::ATTR_HUID>());
-            }
-    }
     else
     {
 
-        HDAT_ERR(" Input target with HUID [0x%08X] is not of proc/mcbist/dimm target type",
+        HDAT_ERR(" Input target with HUID [0x%08X] is not of proc/mcbist target type",
                         i_pTarget->getAttr<TARGETING::ATTR_HUID>());
     }
  
-- 
1.8.2.2

